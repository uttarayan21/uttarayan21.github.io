---
layout: post
title: "Auto generate Rust documentation using github actions and host in Github Pages"
<!-- date: Wed, 10 Mar 2021 00:41:20 -->
<!-- date: Tue Jun  1 06:17:49 PM IST 2021 -->

categories: github git github-actions rust documentation
---

So I host the documentation for my projects in my personal github pages.

Now [rust](https://rust-lang.org) documentation can be easily generated by using [cargo doc](https://doc.rust-lang.org/cargo/commands/cargo-doc.html) command.

But uploading the documentation to github on every commit is a bit annoying.

So now to automate it using github actions.

GitHub workflows are written in yaml.

Okay so to generate and push the documentation we do the following

- Generate the docs in master branch (cargo doc).
- Switch to gh-pages branch.
- Remove the current `docs` folder.
- Copy the `target/doc` folder to `docs`.
- Copy the `index.html` file to docs folder.
- Push the changes

The cargo doc generates a documentation at https://<username>.github.io/<repo_name>/<crate_name>/index.html  
So we can redirect https://<username>.github.io/<repo_name> to the actual documentation.  
That's why the index.html is needed in the docs folder.

Go to settings of the repo and under github pages set source branch to gh-pages and source folder to /docs

The workflow file I use for this is

```yaml
name: Documentation
on:
  push:
    branches: [master]
env:
  CARGO_TERM_COLOR: always
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: Install latest toolchain
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          default: true
          override: true
      - name: Build Docs
        run: cargo doc --color=always
      - name: Copy docs and push
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git checkout gh-pages
          rm -rf docs
          cp -r target/doc ./docs
          cp index.html docs/
          git commit -am "Generated docs from github-actions[bot]"
          git add docs
          git push
```

The `index.html` file mentioned should have the following contents

```html
<!DOCTYPE html>
<html>
  <head>
    <title>HTML Meta Tag</title>
    <meta http-equiv="refresh" content="0; url = https://<username>.github.io/<repo_name>/<crate_name>/index.html" />
  </head>
  <body>
    <p>Redirecting to documentation</p>
  </body>
</html>
```
